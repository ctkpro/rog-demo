function oMousePos(canvas,evt){var ClientRect=canvas.getBoundingClientRect();return{x:Math.round(evt.clientX-ClientRect.left),y:Math.round(evt.clientY-ClientRect.top)}}var canvas=new fabric.Canvas("canvas",{height:.9*window.innerHeight,width:.9*window.innerWidth,backgroundColor:"rgb(0,0,0)",selectionColor:"blue",selectionLineWidth:2});fabric.Object.prototype.selectable=!1;let rect=new fabric.Rect({left:10,top:10,fill:"red",width:20,height:20}),title_box=new fabric.Rect({left:0,top:0,fill:"rgba(0,0,0,0.6)",width:200,height:30}),title_box_border=new fabric.Rect({left:0,top:0,fill:"rgba(255,255,255,0.6)",width:202,height:32}),title=new fabric.Text("This is a book",{fontFamily:"Teko",fontSize:30,fontWeight:300,left:0,top:0,strokeWidth:0,fill:"rgba(255,255,255,0.6)"}),read_more_box=new fabric.Rect({left:0,top:0,fill:"red",width:200,height:30}),read_more=new fabric.Text("MORE",{fontFamily:"Teko",fontSize:30,fontWeight:300,left:0,top:0,strokeWidth:0,fill:"white"});function drawGrid(){canvas.clear();const longer=window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight;let vLine,hLine;d=40;const lineDef={fill:"#aaa",stroke:"rgba(250, 250, 250, 0.2)",strokeWidth:1,selectable:!1};for(let i=-1e3/d;i*d<=2e3;i++)vLine=new fabric.Line([i*d,-1e3,i*d,2e3],lineDef),hLine=new fabric.Line([-1e3,i*d,2e3,i*d],lineDef),i%5==0&&(vLine.stroke="rgba(250,250,250, 0.7)",hLine.stroke="rgba(250,250,250, 0.7)"),canvas.add(vLine,hLine)}drawGrid(),canvas.add(rect),fetch("/js/map_world.json").then(response=>response.json()).then(json=>{for(let i=1;i<json.length;i++){let polygon=new fabric.Polygon([json[i].points[0],json[i].points[1],json[i].points[2]],{left:json[i].left/2,top:json[i].top/2,fill:json[i].fill,scaleX:.5,scaleY:.5,opacity:.6,holder:json[i].fill,role:"none"});canvas.add(polygon)}});const citivas={castitas:{img:"../img/castitas.jpg",link:""},moderatio:{img:"../img/castitas.jpg",link:""},liberalitas:{img:"../img/castitas.jpg",link:""},industria:{img:"../img/castitas.jpg",link:""},patience:{img:"../img/castitas.jpg",link:""},gratia:{img:"../img/castitas.jpg",link:""},humility:{img:"../img/castitas.jpg",link:""}};function setZoom(zoom,x,y){let newZoom=canvas.getZoom()+zoom;newZoom>2?newZoom=2:newZoom<.8&&(newZoom=.8),canvas.zoomToPoint({x:x,y:y},newZoom)}fabric.loadSVGFromURL("js/map_seven_sign.svg",(function(objects,options){for(let i=0;i<objects.length;i++){let polygon=new fabric.Polygon([objects[i].points[0],objects[i].points[1],objects[i].points[2]],{left:objects[i].left/2,top:objects[i].top/2,fill:objects[i].fill,scaleX:.5,scaleY:.5,holder:objects[i].fill,id:objects[i].id,role:"main",img:citivas[objects[i].id].img,link:citivas[objects[i].id].link});setTimeout(()=>{canvas.add(polygon)},200)}console.log(objects)})),canvas.on("mouse:wheel",e=>{if(e.e.ctrlKey){const deltaY=e.e.deltaY,newZoom=deltaY/10*-1;setZoom(newZoom,e.e.offsetX,e.e.offsetY)}});let btnScaleUp=document.querySelector(".scale-up"),btnScalepDown=document.querySelector(".scale-down");btnScaleUp.addEventListener("click",(function(e){setZoom(.2,canvas.width/2,canvas.height/2)})),btnScalepDown.addEventListener("click",(function(e){setZoom(-.2,canvas.width/2,canvas.height/2)}));const dragInfo={isDragging:!1,lastX:0,lastY:0};let img;canvas.on("mouse:down",(function(opt){this.isDragging=!0,this.selection=!1,this.lastX=opt.e.clientX,this.lastY=opt.e.clientY,console.log(opt.target)}));const moveLimit=280;canvas.on("mouse:move",(function(opt){if(this.isDragging){let vpt=this.viewportTransform;vpt[4]>280?vpt[4]=280:vpt[4]<-280*vpt[0]**2?vpt[4]=-280*vpt[0]**2:vpt[4]+=opt.e.clientX-this.lastX,vpt[5]>280?vpt[5]=280:vpt[5]<-280*vpt[0]**2?vpt[5]=-280*vpt[0]**2:vpt[5]+=opt.e.clientY-this.lastY,this.requestRenderAll(),this.lastX=opt.e.clientX,this.lastY=opt.e.clientY}})),canvas.on("mouse:up",(function(opt){this.isDragging=!1,this.selection=!0,this.forEachObject((function(object){object.setCoords()}))})),canvas.on("mouse:over",(function(e){if("none"!=e.target.role){e.target.set("fill","red");let x=e.target.left<1e3?e.target.left+100:e.target.left-220,y=e.target.top-10;title_box_border.set({left:x-1,top:y-1}),title_box.set({left:x,top:y}),title.set({text:e.target.id,left:x+5,top:y}),read_more_box.set({left:x,top:y+240}),read_more.set({left:x+5,top:y+240}),canvas.add(title_box_border,title_box,title,read_more_box,read_more),fabric.Image.fromURL(e.target.img,(function(oImg){img=oImg,oImg.set({left:x,top:y+40,width:200,height:190}),canvas.add(oImg)}))}canvas.renderAll()})),canvas.on("mouse:out",(function(e){"none"!=e.target.role&&(e.target.set("fill",e.target.holder),canvas.remove(title_box,title_box_border,title,img,read_more_box,read_more),canvas.renderAll())}));
//# sourceMappingURL=map.min.js.map